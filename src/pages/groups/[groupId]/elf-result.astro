---
// Elf result page - shows the result for the participant the user is helping as an elf
import Layout from "@/layouts/Layout.astro";
import ElfResultView from "@/components/result/ElfResultView";

const { groupId } = Astro.params;
const { user } = Astro.locals;

// Require authentication
if (!user) {
  return Astro.redirect("/login?returnUrl=" + Astro.url.pathname);
}

// Validate groupId
const parsedGroupId = parseInt(groupId || "0", 10);
if (isNaN(parsedGroupId) || parsedGroupId <= 0) {
  return Astro.redirect("/dashboard?error=invalid_group");
}

// Get helpedParticipantId from query parameters
const helpedParticipantId = Astro.url.searchParams.get("helpedParticipantId");
const parsedHelpedParticipantId = helpedParticipantId ? parseInt(helpedParticipantId, 10) : undefined;
---

<Layout title="Widok Elfa - Secret Santa">
  <ElfResultView
    groupId={parsedGroupId}
    isAuthenticated={true}
    helpedParticipantId={parsedHelpedParticipantId}
    client:load
  />
</Layout>
